<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <title>Ù†Ø¸Ø§Ù… ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø´ÙØªØ§Øª â€” ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body{font-family:Arial, sans-serif;max-width:980px;margin:20px auto;padding:18px;background:#f5f6f8;color:#111}
    h1{text-align:center;margin-bottom:14px}
    .card{background:#fff;padding:14px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.06);margin-bottom:14px}
    label{display:block;margin:8px 0 6px}
    input,select,button{width:100%;padding:8px;border:1px solid #cfcfcf;border-radius:6px;font-size:14px}
    .row{display:flex;gap:10px}
    .row > *{flex:1}
    button.primary{background:#2b7bd3;color:#fff;border:0}
    table{width:100%;border-collapse:collapse;margin-top:10px;font-size:14px}
    th,td{border:1px solid #e0e0e0;padding:8px;text-align:center}
    th{background:#fafafa}
    .small{font-size:13px;color:#666}
    .muted{color:#666}
    .notice{padding:8px;border-radius:6px;background:#fff7d6;color:#7a6000;margin-top:8px}
    .danger{background:#ffdcdc;color:#8b1f1f}
    .inline{display:inline-block;width:auto;padding:6px 10px;border-radius:6px}
    .hidden{display:none}
  </style>
</head>
<body>
  <h1>ğŸ“… Ù†Ø¸Ø§Ù… ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø´ÙØªØ§Øª</h1>

  <!-- AUTH CARD -->
  <div class="card" id="authCard">
    <div id="authForms">
      <h3>ØªØ³Ø¬ÙŠÙ„ / Ø¯Ø®ÙˆÙ„</h3>

      <div id="signupBox">
        <label>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ (Ø¥ÙŠÙ…ÙŠÙ„)</label>
        <input type="email" id="suEmail" placeholder="example@mail.com" />
        <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
        <input type="password" id="suPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" />
        <button id="btnSignup" class="primary">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
      </div>

      <hr style="margin:12px 0" />

      <div id="signinBox">
        <label>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</label>
        <input type="email" id="siEmail" placeholder="example@mail.com" />
        <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
        <input type="password" id="siPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" />
        <button id="btnSignin" class="primary">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</button>
      </div>
    </div>

    <div id="userBox" class="hidden">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div class="small">Ù…ØªØµÙ„ ÙƒÙ€:</div>
          <div id="userEmail" style="font-weight:600"></div>
        </div>
        <div style="text-align:right">
          <button id="btnSignout" class="inline">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
        </div>
      </div>
      <div id="userNotice" class="small muted" style="margin-top:8px">Ø¹Ù†Ø¯Ùƒ Ø·Ù„Ø¨ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø·. ÙŠÙ…ÙƒÙ†Ùƒ Ø­Ø°Ù Ø·Ù„Ø¨Ùƒ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯.</div>
    </div>
  </div>

  <!-- MAIN: form + tables -->
  <div id="mainArea" class="hidden">
    <!-- form -->
    <div class="card">
      <h3>Ø£Ø¶Ù / Ø­Ø¯Ù‘Ø« Ø·Ù„Ø¨ Ø§Ù„Ø´ÙØª (Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„)</h3>

      <label>ğŸ“ Ù…ÙƒØ§Ù† Ø§Ù„Ø¹Ù…Ù„</label>
      <select id="workLocation">
        <option value="Ù…Ù† Ø§Ù„Ø¨ÙŠØª">Ù…Ù† Ø§Ù„Ø¨ÙŠØª</option>
        <option value="Ù…Ù† Ø§Ù„Ø´Ø±ÙƒØ©">Ù…Ù† Ø§Ù„Ø´Ø±ÙƒØ©</option>
      </select>

      <label>ğŸ“ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·)</label>
      <input id="phone" type="text" placeholder="Ù…Ø«Ø§Ù„: 0551234567" />

      <label>âš§ Ø§Ù„Ø¬Ù†Ø³</label>
      <select id="gender">
        <option value="Ø°ÙƒØ±">Ø°ÙƒØ±</option>
        <option value="Ø£Ù†Ø«Ù‰">Ø£Ù†Ø«Ù‰</option>
      </select>

      <div class="row" style="margin-top:6px">
        <div>
          <label>Ø§Ù„Ø´ÙØª Ø§Ù„Ø­Ø§Ù„ÙŠ</label>
          <select id="currentShift">
            <option value="11-8">11-8</option>
            <option value="5-2">5-2</option>
          </select>
        </div>
        <div>
          <label>Ø§Ù„Ø´ÙØª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</label>
          <select id="wantedShift">
            <option value="11-8">11-8</option>
            <option value="5-2">5-2</option>
          </select>
        </div>
      </div>

      <div style="display:flex;gap:8px;margin-top:10px">
        <button id="btnSubmit" class="primary">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
        <button id="btnDelete" class="inline danger hidden">Ø­Ø°Ù Ø·Ù„Ø¨ÙŠ</button>
      </div>

      <div id="formMessage" class="notice hidden"></div>
    </div>

    <!-- tables -->
    <div class="card">
      <h3>Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ø­Ø§Ù„ÙŠ (Ø³ØªÙØ¹Ø±Ø¶ Ø­Ø³Ø¨ Ø§Ø®ØªÙŠØ§Ø±Ùƒ: Ù…Ù† Ø§Ù„Ø¨ÙŠØª / Ù…Ù† Ø§Ù„Ø´Ø±ÙƒØ©)</h3>
      <div class="small">Ù„Ù† ØªØ±Ù‰ Ø·Ù„Ø¨Ø§Øª Ù…ÙƒØ§Ù† Ø¢Ø®Ø± â€” Ù‡Ø°Ø§ ÙŠÙ…Ù†Ø¹Ùƒ Ù…Ù† Ø±Ø¤ÙŠØ© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ© Ø¥Ù† Ø§Ø®ØªØ±Øª "Ù…Ù† Ø§Ù„Ø¨ÙŠØª" ÙˆØ§Ù„Ø¹ÙƒØ³.</div>
      <table>
        <thead>
          <tr><th>Ù…ÙƒØ§Ù† Ø§Ù„Ø¹Ù…Ù„</th><th>Ø§Ù„Ù‡Ø§ØªÙ</th><th>Ø§Ù„Ø¬Ù†Ø³</th><th>Ø´ÙØª Ø§Ù„Ø­Ø§Ù„ÙŠ</th><th>Ø´ÙØª Ù…Ø·Ù„ÙˆØ¨</th></tr>
        </thead>
        <tbody id="requestsTable"></tbody>
      </table>
    </div>

    <div class="card">
      <h3>Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØªÙŠ Ù„Ù‡Ø§ ØªØ¨Ø§Ø¯Ù„ Ù…ØªØ§Ø­ (Ø¶Ù…Ù† Ù†ÙØ³ Ø§Ù„Ù…ÙƒØ§Ù†)</h3>
      <table>
        <thead>
          <tr><th>Ù…ÙƒØ§Ù† Ø§Ù„Ø¹Ù…Ù„</th><th>Ø§Ù„Ù‡Ø§ØªÙ</th><th>Ø§Ù„Ø¬Ù†Ø³</th><th>Ø´ÙØª Ø§Ù„Ø­Ø§Ù„ÙŠ</th><th>Ø´ÙØª Ù…Ø·Ù„ÙˆØ¨</th></tr>
        </thead>
        <tbody id="matchesTable"></tbody>
      </table>
    </div>
  </div>

  <!-- Firebase -->
  <script type="module">
    // Ø§Ø³ØªÙŠØ±Ø§Ø¯
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";
    import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";

    // ---- Ø¶Ø¹ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù…Ø´Ø±ÙˆØ¹Ùƒ Ù‡Ù†Ø§ ----
    const firebaseConfig = {
      apiKey: "AIzaSyB_EMe5vTzJHdvxH8ooRYgLCQdWZFgvsgQ",
      authDomain: "swap-8005b.firebaseapp.com",
      databaseURL: "https://swap-8005b-default-rtdb.firebaseio.com",
      projectId: "swap-8005b",
      storageBucket: "swap-8005b.appspot.com",
      messagingSenderId: "464443469235",
      appId: "1:464443469235:web:4d7904eeb3952402342fc6"
    };
    // -----------------------------------------------

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);
    const requestsRef = ref(db, 'requests');

    // DOM
    const authCard = document.getElementById('authCard');
    const authForms = document.getElementById('authForms');
    const signupBox = document.getElementById('signupBox');
    const signinBox = document.getElementById('signinBox');
    const btnSignup = document.getElementById('btnSignup');
    const btnSignin = document.getElementById('btnSignin');
    const suEmail = document.getElementById('suEmail');
    const suPass = document.getElementById('suPass');
    const siEmail = document.getElementById('siEmail');
    const siPass = document.getElementById('siPass');

    const userBox = document.getElementById('userBox');
    const userEmail = document.getElementById('userEmail');
    const btnSignout = document.getElementById('btnSignout');

    const mainArea = document.getElementById('mainArea');
    const workLocationEl = document.getElementById('workLocation');
    const phoneEl = document.getElementById('phone');
    const genderEl = document.getElementById('gender');
    const currentShiftEl = document.getElementById('currentShift');
    const wantedShiftEl = document.getElementById('wantedShift');
    const btnSubmit = document.getElementById('btnSubmit');
    const btnDelete = document.getElementById('btnDelete');
    const formMessage = document.getElementById('formMessage');

    const requestsTable = document.getElementById('requestsTable');
    const matchesTable = document.getElementById('matchesTable');

    // Ø­Ø§Ù„Ø© Ù…Ø­Ù„ÙŠØ©
    let allRequests = {}; // ÙƒØ§Ù…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Firebase (key -> item)
    let currentUser = null;
    let myRequestKey = null; // Ù…ÙØªØ§Ø­ Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ DB Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯

    // --- AUTH handlers ---
    btnSignup.addEventListener('click', async () => {
      const email = suEmail.value.trim();
      const pass = suPass.value;
      if (!email || !pass) return alert('Ø§Ø¯Ø®Ù„ Ø¥ÙŠÙ…ÙŠÙ„ ÙˆÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±.');
      try {
        await createUserWithEmailAndPassword(auth, email, pass);
        alert('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨. ÙŠÙ…ÙƒÙ†Ùƒ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù†.');
        suEmail.value = ''; suPass.value = '';
      } catch(err) {
        alert('Ø®Ø·Ø£ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨: ' + err.message);
      }
    });

    btnSignin.addEventListener('click', async () => {
      const email = siEmail.value.trim();
      const pass = siPass.value;
      if (!email || !pass) return alert('Ø§Ø¯Ø®Ù„ Ø¥ÙŠÙ…ÙŠÙ„ ÙˆÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±.');
      try {
        await signInWithEmailAndPassword(auth, email, pass);
        siEmail.value = ''; siPass.value = '';
      } catch(err) {
        alert('Ø®Ø·Ø£ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ' + err.message);
      }
    });

    btnSignout.addEventListener('click', async () => {
      await signOut(auth);
    });

    // --- React to auth state ---
    onAuthStateChanged(auth, user => {
      currentUser = user;
      if (user) {
        // Ø¹Ø±Ø¶ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        authForms.classList.add('hidden');
        userBox.classList.remove('hidden');
        userEmail.textContent = user.email;
        mainArea.classList.remove('hidden');
        // ÙÙˆØ±Ù‹Ø§ Ù†ØªØ­Ù‚Ù‚ Ù„Ùˆ Ø¹Ù†Ø¯Ù‡ Ø·Ù„Ø¨ Ù…ÙˆØ¬ÙˆØ¯
        findMyRequest();
      } else {
        // Ø¹Ø±Ø¶ Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„ØªØ³Ø¬ÙŠÙ„/ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        authForms.classList.remove('hidden');
        userBox.classList.add('hidden');
        mainArea.classList.add('hidden');
        userEmail.textContent = '';
        myRequestKey = null;
      }
    });

    // --- Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„ØªØºÙŠØ±Ø§Øª Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Realtime) ---
    onValue(requestsRef, (snap) => {
      const val = snap.val() || {};
      allRequests = val; // ÙƒØ§Ø¦Ù† {key: {workLocation, phone,...}}
      refreshUI();
    });

    // --- Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© ---
    function refreshUI(){
      // Ù†Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù„Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ø°ÙŠ Ø§Ø®ØªØ§Ø±Ù‡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø¥Ø°Ø§ Ù…Ø³Ø¬Ù„)
      const userLoc = workLocationEl.value;

      // Ø¬Ø¯ÙˆÙ„ ÙƒÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª (ÙÙ„ØªØ± Ø¨Ø§Ù„Ù…ÙƒØ§Ù†)
      requestsTable.innerHTML = '';
      Object.entries(allRequests).forEach(([key, req]) => {
        if (!userLoc || req.workLocation !== userLoc) return;
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${escapeHtml(req.workLocation)}</td>
                        <td>${escapeHtml(req.phone)}</td>
                        <td>${escapeHtml(req.gender)}</td>
                        <td>${escapeHtml(req.currentShift)}</td>
                        <td>${escapeHtml(req.wantedShift)}</td>`;
        requestsTable.appendChild(tr);
      });

      // Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø§Øª (Ø¶Ù…Ù† Ù†ÙØ³ Ø§Ù„Ù…ÙƒØ§Ù†)
      matchesTable.innerHTML = '';
      const seen = new Set();
      Object.entries(allRequests).forEach(([k1, r1]) => {
        if (!userLoc || r1.workLocation !== userLoc) return;
        const match = Object.entries(allRequests).find(([k2, r2]) =>
          k1 !== k2 &&
          r2.workLocation === r1.workLocation &&
          r2.currentShift === r1.wantedShift &&
          r2.wantedShift === r1.currentShift
        );
        if (match && !seen.has(k1) && !seen.has(match[0])) {
          // Ø¹Ø±Ø¶ ÙƒÙ„Ø§ Ø§Ù„Ø·Ø±ÙÙŠÙ† ÙƒØµÙ ÙˆØ§Ø­Ø¯ (Ù†Ø®ØªØ§Ø± Ø¹Ø±Ø¶ r1 Ø£ÙˆÙ„Ø§Ù‹)
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${escapeHtml(r1.workLocation)}</td>
                          <td>${escapeHtml(r1.phone)} â‡„ ${escapeHtml(match[1].phone)}</td>
                          <td>${escapeHtml(r1.gender)}</td>
                          <td>${escapeHtml(r1.currentShift)}</td>
                          <td>${escapeHtml(r1.wantedShift)}</td>`;
          matchesTable.appendChild(tr);
          seen.add(k1); seen.add(match[0]);
        }
      });

      // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (ÙˆØ¬ÙˆØ¯/Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯)
      if (currentUser) {
        // Ù†Ø¨Ø­Ø« Ø¹Ù† Ø·Ù„Ø¨ Ø­ÙŠØ« userId === currentUser.uid
        myRequestKey = null;
        Object.entries(allRequests).forEach(([k, r]) => {
          if (r.userId === currentUser.uid) myRequestKey = k;
        });

        if (myRequestKey) {
          // Ø¹Ø·Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ØŒ ÙˆØ£Ø¸Ù‡Ø± Ø²Ø± Ø­Ø°Ù ÙˆØ¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø¨
          btnSubmit.disabled = true;
          btnDelete.classList.remove('hidden');
          formMessage.classList.remove('hidden');
          const my = allRequests[myRequestKey];
          formMessage.innerHTML = `Ù„Ø¯ÙŠÙƒ Ø·Ù„Ø¨ Ù…ÙØ¹Ù„:<br>
            <strong>Ù…ÙƒØ§Ù†:</strong> ${escapeHtml(my.workLocation)} â€” <strong>Ù‡Ø§ØªÙ:</strong> ${escapeHtml(my.phone)} â€” <strong>Ø´ÙØª:</strong> ${escapeHtml(my.currentShift)} â†’ ${escapeHtml(my.wantedShift)}`;
          // Ø¶Ø¹ Ø§Ù„Ù‚ÙŠÙ… ÙÙŠ Ø§Ù„Ø­Ù‚ÙˆÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„Ù„Ø¹Ø±Ø¶)
          phoneEl.value = my.phone;
          genderEl.value = my.gender;
          currentShiftEl.value = my.currentShift;
          wantedShiftEl.value = my.wantedShift;
          workLocationEl.value = my.workLocation;
        } else {
          btnSubmit.disabled = false;
          btnDelete.classList.add('hidden');
          formMessage.classList.add('hidden');
          phoneEl.value = '';
        }
      }
    }

    // ØªØ­Ù‚Ù‚ Ø¥Ù† Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø¬Ø¯ÙŠØ¯ ÙˆØºÙŠØ± Ù…Ø³Ø¬Ù„ (Ù…Ù†Ø¹ Ø³Ø¨Ø§Ù…)
    function phoneExists(phone){
      return Object.values(allRequests).some(r => r.phone === phone);
    }

    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„)
    function findMyRequest(){
      if (!currentUser) return;
      myRequestKey = null;
      Object.entries(allRequests).forEach(([k, r]) => {
        if (r.userId === currentUser.uid) myRequestKey = k;
      });
      refreshUI();
    }

    // Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ (Ù…Ø±ØªØ¨Ø· Ø¨Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…)
    btnSubmit.addEventListener('click', async () => {
      if (!currentUser) return alert('ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹.');
      const workLocation = workLocationEl.value;
      const phone = phoneEl.value.trim();
      const gender = genderEl.value;
      const currentShift = currentShiftEl.value;
      const wantedShift = wantedShiftEl.value;

      if (!/^[0-9]{9,12}$/.test(phone)) {
        alert('Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø· ÙˆØ·ÙˆÙ„Ù‡ Ø¨ÙŠÙ† 9 Ùˆ12 Ø±Ù‚Ù….');
        return;
      }

      // Ù…Ù†Ø¹ ØªÙƒØ±Ø§Ø± Ø±Ù‚Ù…
      if (phoneExists(phone)) {
        alert('Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… Ù…Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙØ¹Ù„. Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø£ÙƒØ«Ø± Ù…Ù† Ø·Ù„Ø¨ Ø¨Ù†ÙØ³ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ.');
        return;
      }

      // Ù…Ù†Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ø¥Ø¶Ø§ÙØ© Ø£ÙƒØ«Ø± Ù…Ù† Ø·Ù„Ø¨ (ØªØ­Ù‚Ù‘Ù‚ Ø¥Ø¶Ø§ÙÙŠ)
      if (Object.values(allRequests).some(r => r.userId === currentUser.uid)) {
        alert('Ù„Ø¯ÙŠÙƒ Ø·Ù„Ø¨ Ø­Ø§Ù„ÙŠØ§Ù‹. Ø§Ø­Ø°Ù Ø·Ù„Ø¨Ùƒ Ø£ÙˆÙ„Ø§ Ø¥Ù† Ø£Ø±Ø¯Øª Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯.');
        return;
      }

      // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ù„Ø¨ Ù…Ø±ØªØ¨Ø· Ø¨Ø§Ù„Ù€ userId + email
      try {
        await push(requestsRef, {
          userId: currentUser.uid,
          email: currentUser.email,
          workLocation, phone, gender, currentShift, wantedShift,
          createdAt: Date.now()
        });
        // Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Ø­Ø¯Ø« onValue
      } catch(err) {
        alert('Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨: ' + err.message);
      }
    });

    // Ø­Ø°Ù Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø¥Ù† ÙˆØ¬Ø¯)
    btnDelete.addEventListener('click', async () => {
      if (!myRequestKey) return alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨ Ù„Ø­Ø°ÙÙ‡.');
      const sure = confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø·Ù„Ø¨Ùƒ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ');
      if (!sure) return;
      try {
        await remove(ref(db, 'requests/' + myRequestKey));
        myRequestKey = null;
        alert('ØªÙ… Ø­Ø°Ù Ø·Ù„Ø¨Ùƒ.');
      } catch(err) {
        alert('Ø®Ø·Ø£ Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø°Ù: ' + err.message);
      }
    });

    // Ù…Ø³Ø§Ø¹Ø¯Ø©: sanitize
    function escapeHtml(s){
      if (s == null) return '';
      return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');
    }

    // Ù„Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠÙ‘Ø± workLocation (ÙŠØ±ÙŠØ¯ ÙŠØ¨Ø¯Ù‘Ù„ Ø§Ù„Ø¹Ø±Ø¶) Ù†Ø¹ÙŠØ¯ Ø¨Ù†Ø§Ø¡ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ÙÙˆØ±ÙŠØ§Ù‹
    workLocationEl.addEventListener('change', () => refreshUI());

  </script>
</body>
</html>
