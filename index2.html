<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ù…Ø´Ø±ÙˆØ¹ÙŠ â€” ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</title>
  <style>
    body {
      margin: 0;
      font-family: 'Cairo', sans-serif;
      background: #f5f6fa;
    }

    /* Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ */
    #app {
      visibility: hidden;
    }

    /* ÙˆØ§Ø¬Ù‡Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
    #login-overlay {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #0f1724, #243b55);
      z-index: 99999;
      color: white;
    }

    .login-box {
      width: 320px;
      padding: 30px;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.08);
      text-align: center;
      box-shadow: 0 0 25px rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(8px);
    }

    .login-box h2 {
      margin-bottom: 20px;
    }

    .login-box input {
      width: 90%;
      padding: 10px;
      margin: 8px 0;
      border: none;
      border-radius: 6px;
      background: rgba(255, 255, 255, 0.2);
      color: white;
      font-size: 14px;
      outline: none;
    }

    .login-box input::placeholder {
      color: #ccc;
    }

    .login-box button {
      width: 95%;
      padding: 10px;
      margin-top: 10px;
      border: none;
      border-radius: 6px;
      background: #00b4d8;
      color: white;
      font-size: 15px;
      cursor: pointer;
      transition: 0.3s;
    }

    .login-box button:hover {
      background: #0096c7;
    }

    #msg {
      margin-top: 10px;
      font-size: 14px;
      color: #f8d210;
      min-height: 18px;
    }

    /* Ù…Ù†Ø¹ Ø§Ù„ØªÙØ§Ø¹Ù„ Ø£Ø«Ù†Ø§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ */
    body.login-blocked *:not(#login-overlay):not(#login-overlay *) {
      pointer-events: none;
      user-select: none;
    }

    /* Ø¨Ø¹Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
    .show-app #app {
      visibility: visible;
    }

    .hide-overlay {
      transition: opacity 0.6s ease;
      opacity: 0;
      pointer-events: none;
    }
  </style>
</head>
<body class="login-blocked">

  <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
  <div id="login-overlay">
    <div class="login-box">
      <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
      <input id="email" type="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" autocomplete="username">
      <input id="password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" autocomplete="current-password">
      <button id="loginBtn">Ø¯Ø®ÙˆÙ„</button>
      <p id="msg"></p>
    </div>
  </div>

  <!-- Ù…Ø­ØªÙˆÙ‰ Ù…Ø´Ø±ÙˆØ¹Ùƒ Ù‡Ù†Ø§ -->
  <div id="app">
    <h1 style="text-align:center;margin-top:50px;">âœ¨ Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ø´Ø±ÙˆØ¹Ùƒ âœ¨</h1>
    <p style="text-align:center;">Ù„Ù† ÙŠØ¸Ù‡Ø± Ù‡Ø°Ø§ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¥Ù„Ø§ Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„ØµØ­ÙŠØ­.</p>

    <div style="text-align:center; margin-top:40px;">
      <button id="logoutBtn" style="padding:10px 20px; border:none; border-radius:6px; background:#e63946; color:white; cursor:pointer;">
        ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
      </button>
    </div>
  </div>

  <!-- Ù…ÙƒØªØ¨Ø© Supabase -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script>
    const SUPABASE_URL = "https://ryjbcecsfjfbksfejbnm.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ5amJjZWNzZmpmYmtzZmVqYm5tIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI5MDEwMjIsImV4cCI6MjA3ODQ3NzAyMn0.IPsvANF9n7SbOlQo-BMt55QQWlQcptWbA1kL9nxCJjQ";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    const overlay = document.getElementById("login-overlay");
    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const msg = document.getElementById("msg");

    // âœ… Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø¹Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„
    function showApp() {
      document.body.classList.remove("login-blocked");
      document.body.classList.add("show-app");
      overlay.classList.add("hide-overlay");
      setTimeout(() => (overlay.style.display = "none"), 600);
    }

    // ğŸ” ÙØ­Øµ Ø§Ù„Ø¬Ù„Ø³Ø© (Ù„Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹)
    async function checkSession() {
      try {
        const { data, error } = await supabase.auth.getSession();
        if (data.session && data.session.user) {
          showApp();
        }
      } catch (e) {
        console.error("Session error:", e);
      }
    }

    checkSession();

    // ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    loginBtn.addEventListener("click", async () => {
      msg.textContent = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...";
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value.trim();

      if (!email || !password) {
        msg.textContent = "âš ï¸ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±";
        return;
      }

      try {
        const { data, error } = await supabase.auth.signInWithPassword({ email, password });

        if (error) {
          console.error("Auth error:", error.message);
          msg.textContent = "âŒ " + (error.message === "Invalid login credentials" ? "Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©" : error.message);
          return;
        }

        msg.textContent = "âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­";
        showApp();

      } catch (err) {
        console.error("Connection error:", err);
        msg.textContent = "âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Supabase";
      }
    });

    // ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
    logoutBtn.addEventListener("click", async () => {
      await supabase.auth.signOut();
      location.reload();
    });
  </script>
</body>
</html>
